<div class="chat-container">

  <!-- Definiši ng-template NA VRHU -->
  <ng-template #noGroupSelected>
    <div class="chat-box placeholder">
      <p>Изаберите групу да бисте започели ћаскање.</p>
    </div>
  </ng-template>

  <!-- Sidebar: Moje grupe -->
  <div class="sidebar">
    <h3>Моје групе</h3>
    <ul>
      <li *ngFor="let group of groups" 
          (click)="selectGroup(group)" 
          [class.active]="group === selectedGroup">
        {{ group.name }}
      </li>
    </ul>
  </div>

  <!-- Sidebar: Kreiranje grupe (vidi samo admin) -->
  <div class="sidebar" *ngIf="userIsAdmin">
    <h3>Креирање групе</h3>

    <div class="create-group">
      <input type="text" [(ngModel)]="newGroupName" placeholder="Унесите назив нове групе" />
      <button (click)="createGroup()" [disabled]="!newGroupName.trim()">Креирај групу</button>
    </div>
  </div>

  <!-- Glavni chat deo -->
  <div class="chat-box" *ngIf="selectedGroup; else noGroupSelected">

    <h3>Група: {{ selectedGroup.name }}</h3>

    <!-- Debug info -->
    <div class="debug-info" style="background:#eee; padding:8px; margin-bottom:15px; font-size:0.9rem;">
      <p><strong>Админ групе:</strong> {{ selectedGroup.admin?.username }}</p>
    </div>

    <!-- Poruke -->
    <div class="messages" #messagesContainer>
      <div *ngFor="let msg of messages" class="message">
        <strong>{{ msg.senderUsername }}:</strong> {{ msg.content }}
        <span class="timestamp">{{ msg.timestamp | date:'shortTime' }}</span>
      </div>
    </div>

    <!-- Panel za dodavanje/uklanjanje korisnika – SAMO za admina -->
    <div class="admin-panel" *ngIf="userIsAdmin">
      <h4>Опције управљања групом</h4>

      <div class="add-user">
        <input [(ngModel)]="usernameToAdd" 
               placeholder="Корисничко име за додавање" 
               (input)="searchUsersForAdd()"
               autocomplete="off"
        />
        <button (click)="addUserToGroup()">Додај корисника</button>

        <ul class="autocomplete-list" *ngIf="showUserSearchDropdown">
          <li *ngFor="let user of searchedUsers" (click)="selectUserToAdd(user)">
            {{ user.username }}
          </li>
        </ul>
      </div>

      <div class="remove-user">
        <input [(ngModel)]="usernameToRemove" placeholder="Корисничко име за уклањање" readonly />
        <button (click)="removeUserFromGroup()">Уклони корисника</button>

        <ul class="members-list">
          <li *ngFor="let member of groupMembersForRemoval">
            {{ member.username }}
            <button (click)="removeUser(member)" title="Уклони корисника">✖</button>
          </li>
        </ul>
      </div>
    </div>

    <!-- Polje za unos poruke – dostupno svima -->
    <div class="input-area">
      <input type="text" 
             placeholder="Унесите поруку..." 
             [(ngModel)]="newMessage" 
             (keyup.enter)="sendMessage()"
             autocomplete="off"
      />
      <button [disabled]="!newMessage.trim()" (click)="sendMessage()">Пошаљи</button>
    </div>

  </div>

</div>